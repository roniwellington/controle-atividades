<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Atividades</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    form { display: grid; gap: 10px; max-width: 600px; margin: auto; }
    select, input, textarea, button { padding: 8px; font-size: 14px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
    .status-finalizada { background-color: #c8e6c9; }
    .status-andamento { background-color: #fff9c4; }
    .status-pulada { background-color: #ffcdd2; }
</style>
</head>
<body>

<h1>Controle de Atividades</h1>

<form id="atividadeForm">
    <select id="categoria" required>
        <option value="">Selecione a Categoria</option>
        <option value="Atividade Física">Atividade Física</option>
        <option value="Leitura">Leitura</option>
        <option value="Trabalho">Trabalho</option>
        <option value="Estudo">Estudo</option>
        <option value="Hobby">Hobby</option>
        <option value="Outros">Outros</option>
    </select>

    <select id="subcategoria" required>
        <option value="">Selecione a Subcategoria</option>
    </select>

    <input type="text" id="atividade" placeholder="Atividade" required>
    <textarea id="descricao" placeholder="Descrição da Atividade"></textarea>

    <select id="status" required>
        <option value="">Selecione o Status</option>
        <option value="Não Iniciada">Não Iniciada</option>
        <option value="Em andamento">Em andamento</option>
        <option value="Pulada">Pulada</option>
        <option value="Concluída">Concluída</option>
    </select>

    <input type="date" id="dataInicio" required>
    <input type="time" id="horaInicio" readonly>
    <input type="time" id="horaFim" readonly>
    <input type="date" id="dataFim" readonly>

    <button type="submit">Salvar Atividade</button>
</form>

<button id="exportarCSV">Exportar CSV</button>

<table>
    <thead>
        <tr>
            <th>Categoria</th>
            <th>Subcategoria</th>
            <th>Atividade</th>
            <th>Descrição</th>
            <th>Status</th>
            <th>Data Início</th>
            <th>Hora Início</th>
            <th>Hora Fim</th>
            <th>Data Fim</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody id="listaAtividades"></tbody>
</table>

<script>
const categorias = {
    "Atividade Física": ["Caminhada", "Ciclismo", "Academia", "Outros"],
    "Leitura": ["Ficção-Científica", "Fantasia", "Divulgação Científica", "Ciências", "Faculdade"],
    "Trabalho": ["Reunião", "Projeto", "Relatório", "Outros"],
    "Estudo": ["Curso Online", "Faculdade", "Certificação", "Outros"],
    "Hobby": ["Música", "Artesanato", "Fotografia", "Outros"],
    "Outros": ["Outros"]
};

const form = document.getElementById("atividadeForm");
const categoria = document.getElementById("categoria");
const subcategoria = document.getElementById("subcategoria");
const status = document.getElementById("status");
const dataInicio = document.getElementById("dataInicio");
const horaInicio = document.getElementById("horaInicio");
const horaFim = document.getElementById("horaFim");
const dataFim = document.getElementById("dataFim");
const listaAtividades = document.getElementById("listaAtividades");

let atividades = JSON.parse(localStorage.getItem("atividades")) || [];

dataInicio.valueAsDate = new Date();

// Atualiza subcategoria quando a categoria muda
categoria.addEventListener("change", () => {
    subcategoria.innerHTML = "<option value=''>Selecione a Subcategoria</option>";
    categorias[categoria.value]?.forEach(sc => {
        let opt = document.createElement("option");
        opt.value = sc;
        opt.textContent = sc;
        subcategoria.appendChild(opt);
    });
});

// Preenche hora automaticamente com base no status
status.addEventListener("change", () => {
    const agora = new Date();
    if (status.value === "Em andamento") {
        horaInicio.value = agora.toTimeString().slice(0,5);
    }
    if (status.value === "Concluída") {
        horaFim.value = agora.toTimeString().slice(0,5);
        dataFim.valueAsDate = agora;
    }
    if (status.value === "Pulada") {
        dataFim.valueAsDate = agora;
    }
});

// Salvar atividade
form.addEventListener("submit", e => {
    e.preventDefault();
    const atividade = {
        categoria: categoria.value,
        subcategoria: subcategoria.value,
        atividade: document.getElementById("atividade").value,
        descricao: document.getElementById("descricao").value,
        status: status.value,
        dataInicio: dataInicio.value,
        horaInicio: horaInicio.value,
        horaFim: horaFim.value,
        dataFim: dataFim.value
    };
    atividades.push(atividade);
    localStorage.setItem("atividades", JSON.stringify(atividades));
    renderizar();
    form.reset();
    dataInicio.valueAsDate = new Date();
});

// Renderizar lista
function renderizar() {
    listaAtividades.innerHTML = "";
    atividades.forEach((a, i) => {
        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${a.categoria}</td>
            <td>${a.subcategoria}</td>
            <td>${a.atividade}</td>
            <td>${a.descricao}</td>
            <td>${a.status}</td>
            <td>${a.dataInicio}</td>
            <td>${a.horaInicio}</td>
            <td>${a.horaFim}</td>
            <td>${a.dataFim}</td>
            <td>
                <button onclick="editar(${i})" ${a.status === "Concluída" || a.status === "Pulada" ? "disabled" : ""}>Editar</button>
                <button onclick="excluir(${i})">Excluir</button>
            </td>
        `;
        if (a.status === "Concluída") tr.classList.add("status-finalizada");
        if (a.status === "Em andamento") tr.classList.add("status-andamento");
        if (a.status === "Pulada") tr.classList.add("status-pulada");
        listaAtividades.appendChild(tr);
    });
}

// Editar atividade
window.editar = i => {
    const a = atividades[i];
    categoria.value = a.categoria;
    categoria.dispatchEvent(new Event("change"));
    subcategoria.value = a.subcategoria;
    document.getElementById("atividade").value = a.atividade;
    document.getElementById("descricao").value = a.descricao;
    status.value = a.status;
    dataInicio.value = a.dataInicio;
    horaInicio.value = a.horaInicio;
    horaFim.value = a.horaFim;
    dataFim.value = a.dataFim;
    atividades.splice(i, 1);
};

// Excluir atividade
window.excluir = i => {
    atividades.splice(i, 1);
    localStorage.setItem("atividades", JSON.stringify(atividades));
    renderizar();
};

// Exportar CSV
document.getElementById("exportarCSV").addEventListener("click", () => {
    let csv = "Categoria,Subcategoria,Atividade,Descrição,Status,Data Início,Hora Início,Hora Fim,Data Fim\n";
    atividades.forEach(a => {
        csv += `${a.categoria},${a.subcategoria},${a.atividade},${a.descricao},${a.status},${a.dataInicio},${a.horaInicio},${a.horaFim},${a.dataFim}\n`;
    });
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "atividades.csv";
    a.click();
});

renderizar();
</script>

</body>
</html>
